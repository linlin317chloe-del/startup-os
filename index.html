
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ°å£ç§‘ç ” - å“¡å·¥è¡Œå‹•åŠ©æ‰‹</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); }
        .app-gradient { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); }
        .active-tab { color: #6366f1; border-top: 3px solid #6366f1; }
        #map { height: 200px; border-radius: 1.5rem; z-index: 10; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen pb-24 relative shadow-2xl bg-slate-50 overflow-x-hidden">
    
    <header class="app-gradient p-8 pb-16 rounded-b-[3rem] text-white relative shadow-lg">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold">æ°å£ç§‘ç ” Chiao Kou</h1>
                <p class="text-slate-300 text-xs mt-1">{{ todayDate }}</p>
            </div>
            <div class="flex gap-2">
                <button @click="activeTab = 'profile'" class="bg-white/10 p-3 rounded-2xl"><i class="fa-solid fa-user-tie"></i></button>
            </div>
        </div>
    </header>

    <main class="px-5 -mt-10 space-y-6 relative z-10">

        <div v-if="activeTab === 'home'" class="space-y-6">
            <section class="glass p-6 rounded-[2rem] shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-700 text-sm italic">CLOCK-IN SYSTEM</h3>
                    <span class="text-[10px] bg-green-100 text-green-600 px-2 py-1 rounded-lg font-bold">æ¯æ—¥ 8 å°æ™‚åˆ¶</span>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button @click="handleClock('in')" :disabled="attendance.in" :class="attendance.in ? 'bg-slate-100 text-slate-400' : 'bg-indigo-50 text-indigo-600'" class="py-5 rounded-3xl font-bold shadow-inner">
                        <i class="fa-solid fa-sun mb-1 block"></i>{{ attendance.in || 'ä¸Šç­æ‰“å¡' }}
                    </button>
                    <button @click="handleClock('out')" :disabled="!attendance.in || attendance.out" :class="attendance.out ? 'bg-slate-100 text-slate-400' : 'bg-orange-50 text-orange-600'" class="py-5 rounded-3xl font-bold">
                        <i class="fa-solid fa-moon mb-1 block"></i>{{ attendance.out || 'ä¸‹ç­æ‰“å¡' }}
                    </button>
                </div>
                <p class="text-[10px] text-slate-400 mt-4 text-center">â€» å»¶é•·å·¥æ™‚è«‹å¡«å¯«åŠ ç­ç”³è«‹å–®ç¶“æ ¸å‡† </p>
            </section>

            <section class="glass p-5 rounded-[2rem] shadow-xl">
                <h3 class="font-bold text-slate-700 text-sm mb-3"><i class="fa-solid fa-map-location-dot mr-2 text-blue-500"></i>å·®æ—…åœ°åœ–èˆ‡å°èˆª</h3>
                <div id="map" class="mb-3"></div>
                <div class="flex gap-2">
                    <input v-model="locationSearch" placeholder="è¼¸å…¥ç›®çš„åœ°..." class="flex-1 bg-slate-100 p-3 rounded-xl text-sm outline-none">
                    <button @click="openNavigation" class="bg-blue-600 text-white px-4 rounded-xl shadow-lg"><i class="fa-solid fa-location-arrow"></i></button>
                </div>
            </section>

            <div class="grid grid-cols-2 gap-3">
                <button @click="openSOP('in')" class="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 text-left">
                    <i class="fa-solid fa-door-open text-blue-400 mb-2"></i>
                    <p class="text-xs font-bold">å…¥è·æ‰‹çºŒ</p>
                    <p class="text-[9px] text-slate-400">ç¹³äº¤è­‰ä»¶ã€é«”æª¢ [cite: 8]</p>
                </button>
                <button @click="openSOP('out')" class="p-4 bg-white rounded-2xl shadow-sm border border-slate-100 text-left">
                    <i class="fa-solid fa-door-closed text-red-400 mb-2"></i>
                    <p class="text-xs font-bold">é›¢è·äº¤æ¥</p>
                    <p class="text-[9px] text-slate-400">è²¡ç”¢é‚„åˆ—ã€ä¿å¯† [cite: 81, 82]</p>
                </button>
            </div>
        </div>

        <div v-if="activeTab === 'finance'" class="space-y-6">
            <section class="glass p-6 rounded-[2rem] shadow-xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-700">è²»ç”¨å ±æ”¯</h3>
                    <p class="text-xl font-black text-indigo-600 font-mono">${{ totalExp }}</p>
                </div>
                
                <div class="space-y-3">
                    <div class="flex gap-2">
                        <select v-model="newExp.type" class="flex-1 bg-slate-100 p-3 rounded-xl text-sm outline-none">
                            <option value="äº¤é€šè²»">ğŸš— äº¤é€šè²» </option>
                            <option value="é¤é£²è²»">ğŸ± é¤é£²è²» [cite: 54]</option>
                            <option value="ä½å®¿è²»">ğŸ¨ ä½å®¿è²» [cite: 56]</option>
                            <option value="å…¶ä»–è²»ç”¨">ğŸ“¦ å…¶ä»–/é›¶ç”¨é‡‘</option>
                        </select>
                        <input v-model.number="newExp.amount" type="number" placeholder="é‡‘é¡" class="w-24 bg-slate-100 p-3 rounded-xl text-sm outline-none">
                    </div>
                    <input v-model="newExp.note" placeholder="å‚™è¨»/åƒèˆ‡äººæ•¸/å°è±¡ [cite: 61]" class="w-full bg-slate-100 p-3 rounded-xl text-sm outline-none">
                    
                    <div class="relative">
                        <input type="file" accept="image/*" @change="handleImgUpload" id="img-upload" class="hidden">
                        <label for="img-upload" class="flex items-center justify-center w-full py-3 bg-slate-100 border-2 border-dashed border-slate-200 rounded-xl text-slate-500 cursor-pointer hover:bg-slate-200">
                            <i class="fa-solid fa-camera mr-2"></i>{{ newExp.image ? 'æ›´æ›æ”¶æ“š' : 'æ‹æ”/ä¸Šå‚³æ”¶æ“š ' }}
                        </label>
                        <img v-if="newExp.image" :src="newExp.image" class="w-full h-32 object-cover rounded-xl mt-2 border">
                    </div>

                    <p v-if="newExp.amount > 2000" class="text-[10px] text-orange-500 font-bold"><i class="fa-solid fa-triangle-exclamation mr-1"></i>è¶…é NT$2,000 æ‡‰äº‹å‰å ±å‚™ä¸»ç®¡ </p>

                    <button @click="addExp" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg">æ–°å¢ç´€éŒ„</button>
                    <button @click="exportCSV" class="w-full py-3 bg-slate-800 text-white rounded-xl text-xs font-bold"><i class="fa-solid fa-file-csv mr-2"></i>åŒ¯å‡º CSV å ±è¡¨ [cite: 62]</button>
                </div>
            </section>
        </div>

        <div v-if="activeTab === 'manual'" class="space-y-4">
            <section class="glass p-6 rounded-[2rem] shadow-xl overflow-y-auto max-h-[60vh] no-scrollbar">
                <h2 class="font-bold text-lg mb-4 text-slate-800 border-b pb-2">æ°å£ç§‘ç ”å·¥ä½œè¦å‰‡ [cite: 2]</h2>
                <div class="space-y-4 text-sm text-slate-600 leading-relaxed">
                    <div>
                        <p class="font-bold text-slate-800">â— å·¥ä½œæ™‚é–“ [cite: 17]</p>
                        <p>æ¯æ—¥æ­£å¸¸å·¥æ™‚ 8 å°æ™‚ï¼Œæ¯é€±ä¸è¶…é 40 å°æ™‚ã€‚ç¹¼çºŒå·¥ä½œ 4 å°æ™‚ä¼‘æ¯ 30 åˆ†é˜ [cite: 18]ã€‚</p>
                    </div>
                    <div>
                        <p class="font-bold text-slate-800">â— è«‹å‡æµç¨‹ [cite: 38]</p>
                        <p>æ‡‰äº‹å…ˆæ–¼ç³»çµ±è¾¦ç†ã€‚ç—…å‡é€£ 2 æ—¥ä»¥ä¸Šéœ€è¨ºæ–·è­‰æ˜ [cite: 39]ã€‚ç„¡æ•…ä¸åˆ°å·¥ä»¥æ› è·è«– [cite: 40]ã€‚</p>
                    </div>
                    <div>
                        <p class="font-bold text-slate-800">â— ä¿å¯†èˆ‡ç™¼æ˜ [cite: 82, 90]</p>
                        <p>é›¢è·å¾Œä»å…·ä¿å¯†ç¾©å‹™ã€‚è·å‹™ä¸Šä¹‹ç ”ç™¼æˆæœèˆ‡å°ˆåˆ©æ¬Šæ­¸å±¬å…¬å¸æ‰€æœ‰ã€‚</p>
                    </div>
                </div>
            </section>
        </div>

        <div v-if="activeTab === 'profile'" class="space-y-4">
            <section class="glass p-6 rounded-[2rem] shadow-xl">
                <h3 class="font-bold text-slate-700 mb-4">å“¡å·¥è³‡æ–™ç®¡ç†</h3>
                <div class="space-y-3">
                    <input v-model="profile.name" placeholder="å§“å" class="w-full bg-slate-50 p-3 rounded-xl text-sm border">
                    <input v-model="profile.id" placeholder="å·¥è™Ÿ (ä¾‹å¦‚ï¼šS001)" class="w-full bg-slate-50 p-3 rounded-xl text-sm border">
                    <input v-model="profile.emergency" placeholder="ç·Šæ€¥è¯çµ¡äºº [cite: 8]" class="w-full bg-slate-50 p-3 rounded-xl text-sm border">
                    <button @click="saveProfile" class="w-full py-4 bg-slate-800 text-white rounded-2xl font-bold">å„²å­˜æ›´æ–°</button>
                    <button @click="clearLocal" class="w-full py-2 text-red-400 text-[10px] font-bold">æ¸…ç©ºæœ¬æ©Ÿæ‰€æœ‰è³‡æ–™</button>
                </div>
            </section>
        </div>

    </main>

    <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-md border-t flex justify-around p-4 rounded-t-[2.5rem] z-50">
        <button @click="activeTab = 'home'" :class="{'active-tab': activeTab === 'home'}" class="flex flex-col items-center pt-2 text-slate-300">
            <i class="fa-solid fa-house"></i><span class="text-[10px] mt-1 font-bold">é¦–é </span>
        </button>
        <button @click="activeTab = 'finance'" :class="{'active-tab': activeTab === 'finance'}" class="flex flex-col items-center pt-2 text-slate-300">
            <i class="fa-solid fa-wallet"></i><span class="text-[10px] mt-1 font-bold">å ±æ”¯</span>
        </button>
        <button @click="activeTab = 'manual'" :class="{'active-tab': activeTab === 'manual'}" class="flex flex-col items-center pt-2 text-slate-300">
            <i class="fa-solid fa-book-open"></i><span class="text-[10px] mt-1 font-bold">æ‰‹å†Š</span>
        </button>
        <button @click="activeTab = 'profile'" :class="{'active-tab': activeTab === 'profile'}" class="flex flex-col items-center pt-2 text-slate-300">
            <i class="fa-solid fa-id-card"></i><span class="text-[10px] mt-1 font-bold">äººäº‹</span>
        </button>
    </nav>

    <div v-if="showSOP" class="fixed inset-0 bg-black/60 z-[100] flex items-end">
        <div class="w-full bg-white rounded-t-[3rem] p-8 space-y-4 slide-up">
            <h3 class="font-bold text-xl">{{ sopType === 'in' ? 'å…¥è·æ¨™æº–æµç¨‹' : 'é›¢è·æ¨™æº–æµç¨‹' }}</h3>
            <ul class="space-y-3 text-sm text-slate-600">
                <li v-for="item in sopItems" :key="item" class="flex items-center gap-2">
                    <i class="fa-solid fa-circle-check text-green-500"></i> {{ item }}
                </li>
            </ul>
            <button @click="showSOP = false" class="w-full py-4 bg-slate-100 rounded-2xl font-bold mt-4">é—œé–‰</button>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, onMounted, watch, computed } = Vue;

    createApp({
        setup() {
            const activeTab = ref('home');
            const todayDate = new Date().toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            
            // è³‡æ–™å°è±¡
            const profile = ref({ name: '', id: '', emergency: '' });
            const attendance = ref({ in: null, out: null });
            const expenses = ref([]);
            const newExp = ref({ type: 'äº¤é€šè²»', amount: null, note: '', image: null });
            
            // åœ°åœ–èˆ‡å°èˆª
            const locationSearch = ref('');
            let map;

            onMounted(() => {
                // åˆå§‹åŒ–åœ°åœ– (é è¨­è¨­åœ¨å°ç£ä¸­å¿ƒæˆ–æ°å£ç§‘ç ”)
                map = L.map('map').setView([24.78, 120.99], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

                // è¼‰å…¥ localStorage
                const savedProfile = localStorage.getItem('ck_profile');
                if (savedProfile) profile.value = JSON.parse(savedProfile);
                const savedExp = localStorage.getItem('ck_exp');
                if (savedExp) expenses.value = JSON.parse(savedExp);
            });

            // åŠŸèƒ½ï¼šæ‰“å¡
            const handleClock = (type) => {
                const now = new Date().toLocaleTimeString('zh-TW', { hour12: false, hour: '2-digit', minute: '2-digit' });
                if (type === 'in') attendance.value.in = now;
                else attendance.value.out = now;
            };

            // åŠŸèƒ½ï¼šå ±æ”¯å½±åƒ [cite: 58, 60]
            const handleImgUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => newExp.value.image = event.target.result;
                    reader.readAsDataURL(file);
                }
            };

            const addExp = () => {
                if (!newExp.value.amount) return alert('è«‹è¼¸å…¥é‡‘é¡');
                expenses.value.unshift({ ...newExp.value, date: new Date().toLocaleDateString() });
                newExp.value = { type: 'äº¤é€šè²»', amount: null, note: '', image: null };
                localStorage.setItem('ck_exp', JSON.stringify(expenses.value));
            };

            const totalExp = computed(() => expenses.value.reduce((s, i) => s + i.amount, 0));

            // åŠŸèƒ½ï¼šå°èˆª
            const openNavigation = () => {
                if (!locationSearch.value) return alert('è«‹è¼¸å…¥ç›®çš„åœ°');
                window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(locationSearch.value)}`, '_blank');
            };

            // åŠŸèƒ½ï¼šSOP å…§å®¹ 
            const showSOP = ref(false);
            const sopType = ref('');
            const sopItems = computed(() => {
                return sopType.value === 'in' 
                    ? ['ç¹³äº¤èº«åˆ†è­‰å½±æœ¬ã€å­¸æ­·è­‰æ˜ [cite: 8]', 'æä¾›é«”æª¢å ±å‘Š [cite: 8]', 'ç°½ç½²å‹å‹•å¥‘ç´„èˆ‡ä¿å¯†å”è­°', 'è¨­å®šå…¬å¸é€šè¨Šè»Ÿé«”å¸³è™Ÿ']
                    : ['åˆ—å†Šäº¤é‚„å…¬å¸è²¡ç”¢ (é›»è…¦ã€é–€ç¦å¡) [cite: 81]', 'ç ”ç™¼æ•¸æ“šèˆ‡é›»å­è³‡æ–™ç§»äº¤ [cite: 81]', 'ç¢ºèªé›¢è·å¾Œä¿å¯†ç¾©å‹™ç¾©å‹™ç¾©å‹™ç¾©å‹™ç¾©å‹™ [cite: 82]', 'å¡«å¯«é›¢è·æ‰‹çºŒå–®'];
            });
            const openSOP = (type) => { sopType.value = type; showSOP.value = true; };

            const saveProfile = () => { localStorage.setItem('ck_profile', JSON.stringify(profile.value)); alert('è³‡æ–™å·²å„²å­˜'); };
            const exportCSV = () => {
                let csv = "\ufeffæ—¥æœŸ,é¡åˆ¥,é‡‘é¡,å‚™è¨»,æ”¶æ“šå½±åƒ\n";
                expenses.value.forEach(i => csv += `${i.date},${i.type},${i.amount},${i.note},${i.image ? 'æœ‰é™„ä»¶' : 'ç„¡'}\n`);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = `æ°å£ç§‘ç ”å ±æ”¯å–®_${new Date().toISOString().slice(0,10)}.csv`;
                link.click();
            };

            const clearLocal = () => { if(confirm('ç¢ºå®šè¦æ¸…ç©ºå—ï¼Ÿ')) { localStorage.clear(); location.reload(); } };

            return { activeTab, todayDate, profile, attendance, expenses, newExp, totalExp, handleClock, handleImgUpload, addExp, openNavigation, locationSearch, showSOP, sopType, sopItems, openSOP, saveProfile, exportCSV, clearLocal };
        }
    }).mount('#app');
</script>
</body>
</html>
