<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Startup OS Pro - è²»ç”¨å ±æ”¯ç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f1f5f9; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.5); }
        .app-gradient { background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); }
        .receipt-preview { width: 100%; height: 150px; object-fit: cover; border-radius: 1rem; margin-top: 0.5rem; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen pb-28 relative shadow-2xl bg-slate-50 overflow-x-hidden">
    
    <header class="app-gradient p-8 pb-14 rounded-b-[2.5rem] text-white shadow-lg relative">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold">å ±æ”¯ä¸­å¿ƒ</h1>
                <p class="text-indigo-100 text-xs">å“¡å·¥ï¼š{{ profile.name || 'æœªè¨­å®š' }}</p>
            </div>
            <button @click="exportData" class="bg-white/20 p-3 rounded-2xl flex items-center gap-2">
                <i class="fa-solid fa-file-export"></i>åŒ¯å‡º
            </button>
        </div>
    </header>

    <main class="px-5 -mt-8 space-y-6 relative z-10">
        
        <section class="glass p-6 rounded-[2rem] shadow-xl space-y-4">
            <div class="flex justify-between items-end">
                <h3 class="font-bold text-slate-700">æ–°å¢å ±æ”¯é …ç›®</h3>
                <p class="text-2xl font-black text-indigo-600 font-mono">${{ totalExp }}</p>
            </div>

            <div class="space-y-3 bg-slate-50 p-4 rounded-2xl">
                <div class="flex gap-2">
                    <select v-model="newExp.type" class="flex-1 p-3 rounded-xl text-sm border-none shadow-sm outline-none">
                        <option value="äº¤é€šè²»">ğŸš— äº¤é€šè²»</option>
                        <option value="é¤é£²è²»">ğŸ± é¤é£²è²»</option>
                        <option value="ä½å®¿è²»">ğŸ¨ ä½å®¿è²»</option>
                        <option value="å…¶ä»–è²»ç”¨">ğŸ“¦ å…¶ä»–(é›¶ç”¨é‡‘)</option>
                    </select>
                    <input v-model.number="newExp.amount" type="number" placeholder="é‡‘é¡" class="w-24 p-3 rounded-xl text-sm shadow-sm outline-none">
                </div>

                <input v-model="newExp.note" type="text" placeholder="è¼¸å…¥å‚™è¨» (å¦‚ï¼šå»å°ä¸­æ‹œè¨ª)" class="w-full p-3 rounded-xl text-sm shadow-sm outline-none">

                <div class="relative">
                    <input type="file" accept="image/*" @change="handleFileUpload" id="receipt-upload" class="hidden">
                    <label for="receipt-upload" class="flex items-center justify-center w-full py-3 border-2 border-dashed border-indigo-200 rounded-xl text-indigo-500 hover:bg-indigo-50 transition-all cursor-pointer">
                        <i class="fa-solid fa-camera mr-2"></i>
                        {{ newExp.image ? 'æ›´æ›æ”¶æ“šç…§ç‰‡' : 'æ‹æ”/ä¸Šå‚³æ”¶æ“š' }}
                    </label>
                    <img v-if="newExp.image" :src="newExp.image" class="receipt-preview shadow-md">
                </div>

                <button @click="addExpense" class="w-full py-4 bg-indigo-600 text-white rounded-xl font-bold shadow-lg shadow-indigo-100 active:scale-95 transition-all">
                    ç¢ºå®šæ–°å¢ç´€éŒ„
                </button>
            </div>
        </section>

        <section class="space-y-3">
            <h3 class="font-bold text-slate-400 text-xs uppercase tracking-widest px-2">æ­·å²å ±æ”¯æ˜ç´°</h3>
            <div v-if="expenses.length === 0" class="text-center py-10 text-slate-300">ç›®å‰å°šç„¡ç´€éŒ„</div>
            
            <div v-for="(item, idx) in expenses" :key="idx" class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm space-y-3">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-slate-50 rounded-lg flex items-center justify-center text-indigo-500 font-bold">
                            {{ item.type[0] }}
                        </div>
                        <div>
                            <p class="text-sm font-bold text-slate-700">{{ item.type }}</p>
                            <p class="text-[10px] text-slate-400">{{ item.date }} Â· {{ item.note }}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-lg font-mono font-bold text-slate-800">${{ item.amount }}</p>
                        <button @click="removeExp(idx)" class="text-[10px] text-red-400 font-bold">åˆªé™¤</button>
                    </div>
                </div>
                <div v-if="item.image" class="pt-2">
                    <img :src="item.image" class="w-16 h-16 rounded-lg object-cover border" @click="showImage(item.image)">
                    <p class="text-[8px] text-slate-300 mt-1">é»æ“Šåœ–ç‰‡å¯ç¸®æ”¾ (é è¦½ç”¨)</p>
                </div>
            </div>
        </section>
    </main>

    <div v-if="zoomImg" @click="zoomImg = null" class="fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4">
        <img :src="zoomImg" class="max-w-full max-h-full rounded-lg shadow-2xl">
        <p class="absolute bottom-10 text-white font-bold">é»æ“Šä»»ä½•åœ°æ–¹é—œé–‰</p>
    </div>

    <nav class="fixed bottom-0 left-0 right-0 max-w-md mx-auto bg-white/90 backdrop-blur-lg border-t flex justify-around p-4 rounded-t-[2rem] z-50">
        <button @click="activeTab = 'home'" :class="{ 'text-indigo-600': activeTab === 'home' }" class="flex flex-col items-center text-slate-300">
            <i class="fa-solid fa-house"></i><span class="text-[10px] font-bold mt-1">é¦–é </span>
        </button>
        <button class="text-indigo-600 flex flex-col items-center">
            <i class="fa-solid fa-receipt"></i><span class="text-[10px] font-bold mt-1">å ±æ”¯</span>
        </button>
        <button @click="activeTab = 'profile'" :class="{ 'text-indigo-600': activeTab === 'profile' }" class="flex flex-col items-center text-slate-300">
            <i class="fa-solid fa-user"></i><span class="text-[10px] font-bold mt-1">è¨­å®š</span>
        </button>
    </nav>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const profile = ref({ name: '' });
            const expenses = ref([]);
            const newExp = ref({ type: 'äº¤é€šè²»', amount: null, note: '', image: null });
            const zoomImg = ref(null);

            onMounted(() => {
                const p = localStorage.getItem('emp_profile');
                if (p) profile.value = JSON.parse(p);
                const e = localStorage.getItem('emp_exp_v3');
                if (e) expenses.value = JSON.parse(e);
            });

            watch(expenses, (v) => localStorage.setItem('emp_exp_v3', JSON.stringify(v)), { deep: true });

            const totalExp = computed(() => expenses.value.reduce((s, i) => s + i.amount, 0));

            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // å£“ç¸®åœ–ç‰‡å“è³ªé¿å… localStorage çˆ†æ‰ (ç´„ 0.3)
                        newExp.value.image = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const addExpense = () => {
                if (newExp.value.amount > 0) {
                    expenses.value.unshift({ ...newExp.value, date: new Date().toLocaleDateString() });
                    newExp.value = { type: 'äº¤é€šè²»', amount: null, note: '', image: null };
                    alert('å ±æ”¯æˆåŠŸï¼');
                }
            };

            const removeExp = (idx) => { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) expenses.value.splice(idx, 1); };
            const showImage = (url) => { zoomImg.value = url; };

            const exportData = () => {
                let csv = "\ufeffæ—¥æœŸ,é¡åˆ¥,é‡‘é¡,å‚™è¨»,æ”¶æ“šè­‰æ˜\n";
                expenses.value.forEach(i => {
                    const hasImage = i.image ? "æœ‰é™„ç…§ç‰‡(è«‹è¦‹Appé è¦½)" : "ç„¡æ”¶æ“š";
                    csv += `${i.date},${i.type},${i.amount},${i.note},${hasImage}\n`;
                });
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = `å ±æ”¯æ˜ç´°_${new Date().toISOString().slice(0,10)}.csv`;
                a.click();
            };

            return { profile, expenses, newExp, totalExp, handleFileUpload, addExpense, removeExp, showImage, zoomImg, exportData };
        }
    }).mount('#app');
</script>
</body>
</html>
